<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>The state of evil</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="/css/theme.css" rel="stylesheet">
    <!-- Custom styles for this blog -->
    <link href="/css/lace.css" rel="stylesheet">

        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery.min.js"></script>

    <script>

/* The good stuff begins here */
$(document).ready(function(){
    $('img').hide().one("load",function(){
        $(this).fadeIn(500);
    }).each(function(){
        if(this.complete) $(this).trigger("load");
    });
});


/*global jQuery */
/*!
* FitText.js 1.2
*
* Copyright 2011, Dave Rupert http://daverupert.com
* Released under the WTFPL license
* http://sam.zoy.org/wtfpl/
*
* Date: Thu May 05 14:23:00 2011 -0600
*/

(function( $ ){

  $.fn.fitText = function( kompressor, options ) {

    // Setup options
    var compressor = kompressor || 1,
        settings = $.extend({
          'minFontSize' : Number.NEGATIVE_INFINITY,
          'maxFontSize' : Number.POSITIVE_INFINITY
        }, options);

    return this.each(function(){

      // Store the object
      var $this = $(this);

      // Resizer() resizes items based on the object width divided by the compressor * 10
      var resizer = function () {
        $this.css('font-size', Math.max(Math.min($this.width() / (compressor*10), parseFloat(settings.maxFontSize)), parseFloat(settings.minFontSize)));
      };

      // Call once to set.
      resizer();

      // Call on resize. Opera debounces their resize by default.
      $(window).on('resize.fittext orientationchange.fittext', resizer);

    });

  };

})( jQuery );

$(document).ready(function(){
  jQuery("#responsive_headline").fitText(1.2, { minFontSize: '20px', maxFontSize: '40px' });
  jQuery("#booger").fitText(0.5, { minFontSize: '20px', maxFontSize: '400px' });
});
</script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->   
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></scrip  t>      
<![endif]-->


  </head>
  <body>
<!-- Fixed navbar -->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand active" href="/">www.BraddahIz.com</a>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
    <div class="col-sm-3">
      
    </div><!-- col -->
    <div class="col-sm-6">
      <h1 class="text-center">The state of evil</h1>
    </div>
    <div class="col-sm-3">
      
      <ul class="pager">
        <li class="next">
          <a href="/design-patterns/2015/01/09/bloody-singleton.html">
                Bloody singleton pattern <span class="glyphicon glyphicon-circle-arrow-right"></span>
          </a>
        </li>
      </ul>
      
    </div><!-- col -->
  </div><!-- row -->
</div> 


<div class="container">
  <div class="row">
   <div class="col-sm-2"></div>
     <div class="col-sm-8">
        <h4>Recently I wrote the following abhorrent test code:</h4>

<div class="highlight"><pre><code class="ruby"><span class="no">RSpec</span><span class="o">.</span><span class="n">shared_context</span> <span class="s2">&quot;setup and teardown&quot;</span> <span class="k">do</span>
 
  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">example</span> <span class="o">==</span> <span class="n">example</span><span class="o">.</span><span class="n">example_group</span><span class="o">.</span><span class="n">descendant_filtered_examples</span><span class="o">.</span><span class="n">first</span>
      <span class="c1"># do setup stuff</span>
    <span class="k">end</span>
  <span class="k">end</span>
 
  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">example</span> <span class="o">==</span> <span class="n">example</span><span class="o">.</span><span class="n">example_group</span><span class="o">.</span><span class="n">descendant_filtered_examples</span><span class="o">.</span><span class="n">last</span>
      <span class="c1"># do teardown stuff</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><br>
<strong>Why is this code so awful?</strong>  <u>State across tests is evil</u></p>

<p>Tests (&#39;examples&#39; in RSpec) should be independent of each other.  The code snippet above creates state across an example group.  This code executes as part of the first and last examples in the group with the pointed intention to create state across all examples in the group.</p>

<p>Rspec provides hooks for executing code before and after <code>:each</code> or <code>:all</code> examples in an example group.</p>

<p>The <code>:each</code> hooks execute after entering the example group, prior to each example.  RSpec basically appends the code in the hook to the code in your example.</p>

<p>The <code>:all</code> hooks execute outside of the example group and do not have access to the state of the example group.  Use of the <code>:all</code> hooks is a red flag.  Examples should be independent of each other, performing actions across entire contexts creates dependency across unit tests.  This is usually bad and wrong... badong. </p>

<p><br>
<strong>So why would I write this code?</strong>  <u>Sometimes evil is necessary</u></p>

<p>I was using rspec along with capybara and selenium to perform system tests against a running application.  These tests are meant to replace a human interacting with a live system, nothing is mocked out and just getting to certain function requires a ton of state.</p>

<p>Some test groups depend on system state that is time consuming to setup.  Other test groups require that this state not exist.  Different permutations of the same expensive state are applicable to other test groups, thus having a shared context that creates this state then tears it down made sense.  In order to have access to context specific state (so we can tune the setup for different test groups) I needed access to the state of the context (so I couldn&#39;t use the <code>:all</code> hooks).</p>

<p>In the end I am not satisfied with this solution, if you have a solid system test architecture that is able to test state heavy systems in a lightweight compartmentalized way without mocking, I would happy to hear from you.</p>

     </div> <!-- col-sm-8 -->
   <div class="col-sm-2"></div>
  </div>
</div> 


  </body>
</html>
